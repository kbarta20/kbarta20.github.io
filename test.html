<!DOCTYPE html>
<html>
<head>
  <script src="https://d3js.org/d3.v7.min.js"></script>
  <style>circle { fill: lightblue; stroke: black; }</style>
</head>
<body>
  <h1>World Sustainability Dataset</h1>
  <div id="chart"></div>

  <script>

    async function loadData() {
      // Set up the chart dimensions
      var margin = { top: 50, right: 40, bottom: 50, left: 60 };
      var width = 800 - margin.left - margin.right;
      var height = 500 - margin.top - margin.bottom;

      // Create the SVG element
      var svg = d3
        .select("#chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
        const data = await d3.csv('https://kbarta20.github.io/WorldSustainabilityDataset.csv', d3.autoType);
                        // Convert numerical values from strings to numbers
        const dataArray = Object.values(data);
        var dataArrayF = dataArray.filter(filtered);
      
      // Generate random data within the specified ranges
      //var numDataPoints = 50;
      var CO2damage = dataArrayF.map(d => +d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]);
      var xs = d3.scaleLinear().domain([0, 10]).range([0, width]);

      // Adjust the y-scale domain based on the actual data values for "Access to electricity"
      var electricity = dataArrayF.map(d => +d["GDP per capita (current US$) - NY.GDP.PCAP.CD"]);
      var yDomain = d3.extent(electricity); // Get the min and max values for the domain
      var ys = d3.scaleLinear().domain([yDomain[0] - 5, yDomain[1] + 5]).range([height, 0]);

      var population = dataArrayF.map(d => +d["Population, total - SP.POP.TOTL"]);
      var rs = d3.scaleLinear().domain([0, d3.max(population)]).range([0, 30]);
/*
      //tooltip
      var Tooltip = d3.select("#chart")
    .append("div")
    .style("opacity", 0)
    .attr("class", "tooltip")
    .style("background-color", "white")
    .style("border", "solid")
    .style("border-width", "2px")
    .style("border-radius", "5px")
    .style("padding", "5px")
*/
    var tooltip = d3.select("body")
    .append("div")
    //.html(d)
    //.style("left", d3.select(this).attr("cx") + "px")     
    // .style("top", d3.select(this).attr("cy") + "px")
    //.text("a simple tooltip")
    //.style("position", "absolute")
    //.style("z-index", "10")
    .style("visibility", "hidden");
    //.datum(d)
    //.style("background", "#000")
/*
    var mouseover = function(d) {
    Tooltip
      .style("opacity", 1)
    d3.select(this)
    .text("Hello world")

      .style("stroke", "black")
      .style("opacity", 1)
  }
  var mousemove = function(d) {
    Tooltip
      .html("Country:" + d["Country Name"].value)
      .text(" hello world")
      .style("left", (d3.mouse(this)[0]+70) + "px")
      .style("top", (d3.mouse(this)[1]) + "px")
  }
  var mouseleave = function(d) {
    Tooltip
      .style("opacity", 0)
    d3.select(this)
      //.style("stroke", "none")
      .style("opacity", 0.8)
  }
*/


      svg
        .selectAll('circle')
        .data(dataArrayF)
        .enter()
        .append('circle')
        //.attr("id", "circleTooltip")
        .attr('cx', function (d) { return xs(d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]); })
        .attr('cy', function (d) { return ys(d["GDP per capita (current US$) - NY.GDP.PCAP.CD"]); })
        .attr('r', function (d) { return rs(d["Population, total - SP.POP.TOTL"]); })
        //.on("mouseover", mouseover)
        .on("mouseover", function(event, d){return tooltip.style("visibility", "visible").text(d["Country Name"])
        .style("left", event.pageX+"px")
        .style("top", event.pageY+"px");})
        .on("mousemove", function(){return tooltip.style("top", (event.pageY-10)+"px").style("left",(event.pageX+10)+"px");})
        .on("mouseout", function(){return tooltip.style("visibility", "hidden");});

        //html(d["Country Name"]);
       // .on("mousemove", mousemove)
        //.on("mouseleave", mouseleave);
        //.on("mouseover", mouseOver)
        //.on("mouseout", mouseOut)

      var yAxis = d3.axisLeft(ys).ticks(10).tickFormat(d3.format("~s"));
      svg.append("g").call(yAxis);

      var xAxis = d3.axisBottom(xs).ticks(10).tickFormat(d3.format("~s"));
      svg.append("g").attr("transform", "translate(0," + height + ")").call(xAxis);

                    // create a tooltip
        var tooltip = d3.select("#chart")
        .append("div")
        .style("top", d3.select(this).attr("cx") + "px")
        .style("left", d3.select(this).attr("cx")+"px")
            .style("position", "absolute")
            .style("visibility", "hidden")
            .text("I'm a circle!");

     /*
            d3.select("#circleTooltip")
        .on("mouseover", function(){return tooltip.style("visibility", "visible");})
        .on("mousemove", function(){return tooltip.style("top", (event.pageY-800)+"px").style("left",(event.pageX-800)+"px");})
        .on("mouseout", function(){return tooltip.style("visibility", "hidden");});
*/
      //Axis Labels
      
    svg.append("text")
            .attr("transform","rotate(-90)")
            .attr("y", 0 - margin.left + 10)
            .attr("x", 0 - (height / 2))
            .attr("dy", "1em")
            .style("text-anchor", "middle")
            .text("GDP per capita (current US$)");

            svg.append("text")
              //.attr("transform","translate(250,500")
              .attr("x", 250)
              .attr("y", 440)
              .style("text-anchor", "middle")
              .text("Adjusted savings: carbon dioxide damage (% of GNI)");

    }
    /*
    function mouseOver(d) {
        d3.select(this).append("text")
        //.attr("transform", function(d) {return "rotate("+computeTextRotation(d) +")";})
        .attr("x", function(d) { return y(d.y);})
        .attr("dx", "6")
        .attr("dy", ".35em")
        .attr("class", "mylabel")
        .text(function(d) {return d['Country']})
    }

    function mouseOut(d) {
        d3.selectAll(".mylabel").remove()
    }*/
    function filtered(dataArr) {
            return (dataArr['Year'] == '2018') && (dataArr['Continent']=='Europe')
          } 
    loadData().catch(function (error) {
      console.log(error);
    });
  </script>
</body>
</html>
