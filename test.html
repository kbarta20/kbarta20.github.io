<!DOCTYPE html>
<html>

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        circle {
            fill: lightblue;
            stroke: black;
        }

        .box {
            display: inline-block;
            width: 80px;
            height: 30px;
            border: 1px solid black;
            text-align: center;
            line-height: 30px;
            margin: 0;
            padding: 0;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <h1>World Sustainability Dataset</h1>

    <div id="chart"></div>

    <p> This chart shows a scatterplot of carbon dioxide damage savings
        and GDP per capita of countries in North America.
        The size of the circle corresponds to the population of the country.

    </p>
    <div class="box" id="box1">Chart 1</div>
    <div class="box" id="box2">Current</div>
    <div class="box" id="box3">Chart 3</div>


    <script>
        // Function to handle box click events and redirect to the corresponding pages


        async function loadData() {
            // Set up the chart dimensions
            var margin = { top: 50, right: 40, bottom: 50, left: 60 };
            var width = 600 - margin.left - margin.right;
            var height = 500 - margin.top - margin.bottom;

            // Create the SVG element
            var svg = d3
                .select("#chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            const data = await d3.csv('https://kbarta20.github.io/WorldSustainabilityDataset.csv', d3.autoType);
            // Convert numerical values from strings to numbers
            const dataArray = Object.values(data);
            var dataArrayF = dataArray.filter(filtered);

            // Generate random data within the specified ranges
            //var numDataPoints = 50;
            var CO2damage = dataArrayF.map(d => +d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]);
            var xs = d3.scaleLinear().domain([0, 3]).range([0, width]);

            // Adjust the y-scale domain based on the actual data values for "Access to electricity"
            var electricity = dataArrayF.map(d => +d["GDP per capita (current US$) - NY.GDP.PCAP.CD"]);
            var yDomain = d3.extent(electricity); // Get the min and max values for the domain
            var ys = d3.scaleLinear().domain([yDomain[0] - 5, yDomain[1] + 5]).range([height, 0]);

            var population = dataArrayF.map(d => +d["Population, total - SP.POP.TOTL"]);
            var rs = d3.scaleLinear().domain([0, d3.max(population)]).range([5, 70]);



            var tooltip = d3.select("body")
                .append("div")
                .style("visibility", "hidden");


            svg
                .selectAll('circle')
                .data(dataArrayF)
                .enter()
                .append('circle')
                //.attr("id", "circleTooltip")
                .attr('cx', function (d) { return xs(d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]); })
                .attr('cy', function (d) { return ys(d["GDP per capita (current US$) - NY.GDP.PCAP.CD"]); })
                .attr('r', function (d) { return rs(d["Population, total - SP.POP.TOTL"]); })
                //.on("mouseover", mouseover)
                .on("mouseover", function (event, d) {
                    tooltip.style("visibility", "visible").text(d["Country Name"]);
                    tooltip.style("top", (d.pageY ) + "px")
                        .style("left", (d.pageX ) + "px");
                })
                .on("mousemove", function () { return tooltip.style("top", (event.pageY - 10) + "px").style("left", (event.pageX + 10) + "px"); })
                .on("mouseout", function () { return tooltip.style("visibility", "hidden"); });

            var yAxis = d3.axisLeft(ys).ticks(10).tickFormat(d3.format("~s"));
            svg.append("g").call(yAxis);

            var xAxis = d3.axisBottom(xs).ticks(10).tickFormat(d3.format("~s"));
            svg.append("g").attr("transform", "translate(0," + height + ")").call(xAxis);

            svg.append("text")
                .attr("transform", "translate(220,440)")
                //.attr("x", 250)
                //.attr("y", 200)
                .style("text-anchor", "middle")
                .text("Adjusted savings: carbon dioxide damage (% of GNI)");



            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left + 10)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("GDP per capita (current US$)");


            //Axis Labels


            //add click event to the boxes
            d3.selectAll(".box").on("click", function () {
                var boxId = d3.select(this).attr("id");
                switch (boxId) {
                    case "box1":
                        goTo("index.html");
                        break;
                    case "box2":
                        goTo("chart2.html");
                        break;
                    case "box3":
                        goTo("chart3.html");
                        break;
                    default:
                        break;
                }
            });

            // create a tooltip
            var tooltip = d3.select("#chart")
             .append("div")
            //.style("top", (d3.event.pageY-200)+"px")
            //.style("left", (d3.event.pageX-100)+"px")
               .style("position", "absolute")
             .style("visibility", "hidden")
            // .text("I'm a circle!");


        }

        function filtered(dataArr) {
            return (dataArr['Year'] == '2018') && (dataArr['Continent'] == 'North America')
        }
        loadData().catch(function (error) {
            console.log(error);
        });


        function goTo(page) {
            window.location.href = page;
        }
    </script>
</body>

</html>