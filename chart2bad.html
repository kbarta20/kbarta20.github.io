<html>
<script src="https://d3js.org/d3.v7.min.js"></script>
<style>
  circle {
    fill: lightblue;
    stroke: black;
  }

  .box {
    display: inline-block;
    width: 80px;
    height: 30px;
    border: 1px solid black;
    text-align: center;
    line-height: 30px;
    margin: 0;
    padding: 0;
    cursor: pointer;
  }
</style>

<body>
  <h1> World Sustainability Dataset </h1>

  <div id="chart"></div>

  <p> How does carbon dioxide damage relate to income in different regions?
    This chart compares carbon dioxide damage vs income in 2 different regions: Europe/Northern America and Sub-saharan
    Africa.
    These regions have very different histories in terms of development and history of colonialism.

  </p>
  <div class="box" id="box1">Chart 1</div>
  <div class="box" id="box2">Current</div>
  <div class="box" id="box3">Chart 3</div>
  <script>




    async function loadData() {
      // Set up the chart dimensions
      var margin = { top: 50, right: 40, bottom: 50, left: 40 };
      var width = 800 - margin.left - margin.right;
      var height = 600 - margin.top - margin.bottom;


      var svg = d3
        .select("#chart")
        .append("svg")
        .attr("width", width + margin.left + margin.right)
        .attr("height", height + margin.top + margin.bottom)
        .append("g")
        .attr("transform", "translate(60,80)");
      const data = await d3.csv('https://kbarta20.github.io/WorldSustainabilityDataset.csv', d3.autoType);
      // Convert numerical values from strings to numbers
      const dataArray = Object.values(data);
      var dataArrayF = dataArray.filter(filtered);
      dataArrayF = dataArray.filter(d=> d["Adjusted net national income per capita (annual % growth) - NY.ADJ.NNTY.PC.KD.ZG"] !== null);
      dataArrayF = dataArray.filter(d=> d["Adjusted net savings, excluding particulate emission damage (% of GNI) - NY.ADJ.SVNX.GN.ZS"] !== null);

      // Generate random data within the specified ranges
      //var numDataPoints = 50;
      //  var CO2damage = dataArrayF.map(d => +d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]);
      // var xs = d3.scaleLinear().domain([0, 3]).range([0, width]);

      // Adjust the y-scale domain based on the actual data values for "Access to electricity"
      // var electricity = dataArrayF.map(d => +d["GDP per capita (current US$) - NY.GDP.PCAP.CD"]);
      // var yDomain = d3.extent(electricity); // Get the min and max values for the domain
      // var ys = d3.scaleLinear().domain([yDomain[0] - 5, yDomain[1] + 5]).range([height, 0]);

      // var population = dataArrayF.map(d => +d["Population, total - SP.POP.TOTL"]);
      // var rs = d3.scaleLinear().domain([0, d3.max(population)]).range([5, 70]);



      var tooltip = d3.select("body")
        .append("div")
        .style("visibility", "hidden");

/*
      // Set up the scales
        var xScale = d3
        .scaleBand()
        .range([0, width])
        .padding(0.1)
        .domain(dataArrayF.map(function (d) {
          return d["Country Name"];
        }));

      var yScale = d3
        .scaleLinear()
        .range([height, 0])
        .domain([d3.min(d["Adjusted net savings, excluding particulate emission damage (% of GNI) - NY.ADJ.SVNX.GN.ZS"]), 
                 d3.max(d["Adjusted net savings, excluding particulate emission damage (% of GNI) - NY.ADJ.SVNX.GN.ZS"])])
      //   d3.max(dataArrayF, function (d) {
       //   return d["Adjusted net savings, excluding particulate emission damage (% of GNI) - NY.ADJ.SVNX.GN.ZS"];
        //})
        ;
*/
        const xScale = d3.scaleBand()
  .domain(data.map(d => d.category))
  .rangeRound([0, innerWidth])
  .padding(0.1);

const x1Scale = d3.scaleBand()
  .domain(["Adjusted net national income per capita (annual % growth) - NY.ADJ.NNTY.PC.KD.ZG", "Adjusted net savings, excluding particulate emission damage (% of GNI) - NY.ADJ.SVNX.GN.ZS"])
  .rangeRound([0, xScale.bandwidth()])
  .padding(0.5);

const yScale = d3.scaleLinear()
  .domain([d3.min(data, d => Math.min(d["Adjusted net national income per capita (annual % growth) - NY.ADJ.NNTY.PC.KD.ZG"], d["Adjusted net savings, excluding particulate emission damage (% of GNI) - NY.ADJ.SVNX.GN.ZS"])), d3.max(data, d => Math.max(d["Adjusted net national income per capita (annual % growth) - NY.ADJ.NNTY.PC.KD.ZG"], d["Adjusted net savings, excluding particulate emission damage (% of GNI) - NY.ADJ.SVNX.GN.ZS"]))])
  .rangeRound([innerHeight, 0])
  .nice();

    // Draw the bars for valueX
    svg.selectAll(".bar-x")
      .data(dataArrayF)
      .enter()
      .append("rect")
      .attr("class", "bar bar-x")
      .attr("x", d => xScale(d["Country"]) + xScale.bandwidth() / 4)
      .attr("y", d => yScale(d["Adjusted net national income per capita (annual % growth) - NY.ADJ.NNTY.PC.KD.ZG"]))
      .attr("width", xScale.bandwidth()/2)
      .attr("height", d => Math.abs(yScale(d["Adjusted net national income per capita (annual % growth) - NY.ADJ.NNTY.PC.KD.ZG"]) - yScale(0)))
      .attr("fill", "steelblue");

    // Draw the bars for valueY
    svg.selectAll(".bar-y")
      .data(dataArrayF)
      .enter()
      .append("rect")
      .attr("class", "bar bar-y")
      .attr("x", d => xScale(d["Country"]) + xScale.bandwidth() / 4)
      .attr("y", d => yScale(d["Adjusted net savings, excluding particulate emission damage (% of GNI) - NY.ADJ.SVNX.GN.ZS"]))
      .attr("width", xScale.bandwidth() / 2)
      .attr("height", function(d) {
           var val = Math.abs(yScale(d["Adjusted net savings, excluding particulate emission damage (% of GNI) - NY.ADJ.SVNX.GN.ZS"]) - yScale(0));
            console.log(val);
            //return val;
            return height - yScale(d["Adjusted net savings, excluding particulate emission damage (% of GNI) - NY.ADJ.SVNX.GN.ZS"]);
            })
      .attr("fill", "tomato");



  /*


      
      // .on("mouseover", function (event, d) {
      //             tooltip.style("visibility", "visible").text(d["Country Name"]);
      //             tooltip.style("top", (d.pageY) + "px")
      //                 .style("left", (d.pageX ) + "px");
      //         })
      //.on("mousemove", function () { return tooltip.style("top", (d.pageY - 10) + "px").style("left", (d.pageX + 10) + "px"); })
      //.on("mouseout", function () { return tooltip.style("visibility", "hidden"); });
*/
// Add Y-axis
svg.append("g")
  .attr("class", "y-axis")
  .call(d3.axisLeft(yScale).ticks(10));
  

// Add X-axis
svg.append("g")
  .attr("class", "x-axis")
  .attr("transform", "translate(0,220)")
  .call(d3.axisBottom(xScale).tickSizeOuter(0));
 

  /*
      // Add axes
      svg
        .append("g")
        .attr("transform", "translate(0," + height + ")")
        .call(d3.axisBottom(xScale))
        .selectAll("text")
        .style("text-anchor", "end")
        .attr("transform", "rotate(-45)");

      svg.append("g").call(d3.axisLeft(yScale));
*/
      // Add axis labels
      svg.append("text")
        .attr("transform", `translate(${width / 2},${height + margin.top + 30})`)
        .style("text-anchor", "middle")
        .text("Countries");

     /* svg.append("text")
        .attr("transform", "rotate(-90)")
        .attr("y", 0 - margin.left + 10)
        .attr("x", 0 - (height / 2)-10)
        .attr("dy", "1em")
        .style("text-anchor", "middle")
        .text("Adjusted net savings, excluding particulate emission damage (% of GNI)");

*/


      /*      // Create the SVG element
            var svg = d3
              .select("#chart")
              .append("svg")
              .attr("width", width + margin.left + margin.right)
              .attr("height", height + 100 + margin.top + margin.bottom)
              .append("g")
              .attr("transform", "translate(50,80)");
      
            // Load the CSV file
            const data = await d3.csv('https://kbarta20.github.io/WorldSustainabilityDataset.csv', d3.autoType);
            // Convert numerical values from strings to numbers
            const dataArray = Object.values(data);
            //const dataArray = Array.from(data, ([key,value]) => value);
            data.sort((a, b) => d3.descending(a["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"], b["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]));
            //console.log(dataArray);
            //console.log(data)
            var dataArrayF = dataArray.filter(filtered);
            console.log(dataArrayF)
            dataArrayF.forEach(function (d) {
              d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"] = +d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"];
            });
      
            
            var tooltip = d3.select("body")
                      .append("div")
                      .style("visibility", "hidden");
      
      
            // Set up the scales
            var xScale = d3
              .scaleBand()
              .range([0, width])
              .padding(0.1)
              .domain(dataArrayF.map(function (d) {
                return d["Country Name"];
              }));
      
            var yScale = d3
              .scaleLinear()
              .range([height, 0])
              .domain([0, d3.max(dataArrayF, function (d) {
                return d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"];
              })]);
      
            // Create the bars
            svg
              .selectAll(".bar")
              .data(dataArray)
              .enter()
              .append("rect")
              .attr("class", "bar")
              .attr("x", function (d) {
                return xScale(d["Country Name"]);
              })
              .attr("width", xScale.bandwidth())
              .attr("y", function (d) {
                return yScale(d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]);
              })
              .attr("height", function (d) {
                return height - yScale(d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]);
              })
              .attr("fill", "darkturquoise")
              .on("mouseover", function (event, d) {
                          tooltip.style("visibility", "visible").text(d["Country Name"]);
                          tooltip.style("top", (d.pageY) + "px")
                              .style("left", (d.pageX ) + "px");
                      })
                      .on("mousemove", function () { return tooltip.style("top", (d.pageY - 10) + "px").style("left", (d.pageX + 10) + "px"); })
                      .on("mouseout", function () { return tooltip.style("visibility", "hidden"); });
      ;
      
            // Add axes
            svg
              .append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(xScale))
              .selectAll("text")
              .style("text-anchor", "end")
              .attr("transform", "rotate(-45)");
      
            svg.append("g").call(d3.axisLeft(yScale));
      
            // Add axis labels
            svg.append("text")
              .attr("transform", `translate(${width / 2},${height + margin.top + 30})`)
              .style("text-anchor", "middle")
              .text("Countries");
      
            svg.append("text")
              .attr("transform", "rotate(-90)")
              .attr("y", 0 - margin.left + 10)
              .attr("x", 0 - (height / 2))
              .attr("dy", "1em")
              .style("text-anchor", "middle")
              .text("Adjusted savings: carbon dioxide damage (% of GNI)");
      */


      // add click event  to the boxes
      d3.selectAll(".box").on("click", function () {
        var boxId = d3.select(this).attr("id");
        switch (boxId) {
          case "box1":
            goTo("index.html");
            break;
          case "box2":
            goTo("chart2.html");
            break;
          case "box3":
            goTo("chart3.html");
            break;
          default:
            break;
        }
      });

      // create a tooltip
      var tooltip = d3.select("#chart")
        .append("div")
        //.style("top", (d3.event.pageY-200)+"px")
        //.style("left", (d3.event.pageX-100)+"px")
        .style("position", "absolute")
        .style("visibility", "hidden")

    }
    function filtered(dataArr) {
      return (dataArr['Year'] == '2018') &&
        ((dataArr['Region'] == 'Sub-Saharan Africa') || (dataArr['Region'] == 'Europe and Northern America')
        && dataArr["Adjusted net national income per capita (annual % growth) - NY.ADJ.NNTY.PC.KD.ZG"] !== null
        && dataArr["Adjusted net savings, excluding particulate emission damage (% of GNI) - NY.ADJ.SVNX.GN.ZS"] !== null)
    }
    loadData().catch(function (error) { console.log(error); });

    function goTo(page) {
      window.location.href = page;
    }
  </script>

</body>

</html>