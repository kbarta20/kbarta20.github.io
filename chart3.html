<!DOCTYPE html>
<html>

<head>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    <style>
        circle {

            stroke: black;
        }

        .box {
            display: inline-block;
            width: 80px;
            height: 30px;
            border: 1px solid black;
            text-align: center;
            line-height: 30px;
            margin: 0;
            padding: 0;
            cursor: pointer;
        }
    </style>
</head>

<body>

    <h1>World Sustainability Dataset</h1>

    <p> Final consumption expenditure is the sum of household private consumption and goverment consumption. It varies
        widely between countries. How is this value related to other factors in the country?
        Resource rich countries have a higher potential for consumption in the future, but generally richer countries
        have higher expenditures

        (USE INCOME IN THIS CHART)

        Adjusted net national income is GNI minus consumption/natural resource depletion. Countries with abundant
        natural resources but lower income will see higher depletion of those natural resources.
        Net national income can give a different view from GDP.
        Standard of living increases in less wealthy countries is tied to economic growth that will involve natural
        resources and their consumption. Net national income can give a good view of the potential increases in future
        consumption.
    </p>

    <div id="chart"></div>

    <p> This chart shows a scatterplot of carbon dioxide damage savings
        and Adjusted net national income in % growth in 2018.
        It is the same chart as presented in the first slide, except that it uses net national income growth instead of
        GDP.

        As you can see, it offers a very different picture. Some countries are experiencing negative net income growth.
        This could be due to: ????

        Why do damage costs for carbon dioxide vary so widely from country to country? How does this value relate to
        other statistics?

        Adjusted savings: carbon dioxide damage refers to the cost of damage from carbon dioxide emissions. These
        emissions can be from fossil fuels or the manufacture of cement. The World Bank estimates that it costs US$30
        per ton of CO2.
        This value gives an idea of how much carbon dioxide emissions are costing a country.
        Many countries with a lower GDP encounter more costs associated with carbon dioxide damage.


    </p>
    <div class="box" id="box1">Chart 1</div>
    <div class="box" id="box2">Chart 2</div>
    <div class="box" id="box3">Current</div>


    <script>
        // Function to handle box click events and redirect to the corresponding pages


        async function loadData() {
            // Set up the chart dimensions
            var margin = { top: 50, right: 40, bottom: 50, left: 60 };
            var width = 900 - margin.left - margin.right;
            var height = 500 - margin.top - margin.bottom;

            // Create the SVG element
            var svg = d3
                .select("#chart")
                .append("svg")
                .attr("width", width + margin.left + margin.right)
                .attr("height", height + margin.top + margin.bottom)
                .append("g")
                .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
            const data = await d3.csv('https://kbarta20.github.io/WorldSustainabilityDataset.csv', d3.autoType);
            // Convert numerical values from strings to numbers
            const dataArray = Object.values(data);
            var dataArrayF = dataArray.filter(filtered);

            // Generate random data within the specified ranges
            //var numDataPoints = 50;
            var CO2damage = dataArrayF.map(d => +d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]);
            var xs = d3.scaleLinear().domain([0, 3]).range([0, width]);

            // Adjust the y-scale domain based on the actual data values for "Access to electricity"
            var electricity = dataArrayF.map(d => +d["Adjusted net national income per capita (annual % growth) - NY.ADJ.NNTY.PC.KD.ZG"]);
            var yDomain = d3.extent(electricity); // Get the min and max values for the domain
            var ys = d3.scaleLinear().domain([yDomain[0] - 5, yDomain[1] + 5]).range([height, 0]);

            var population = dataArrayF.map(d => +d["Population, total - SP.POP.TOTL"]);
            var rs = d3.scaleLinear().domain([0, d3.max(population)]).range([5, 40]);



            var tooltip = d3.select("body")
                .append("div")
                .style("visibility", "hidden")
                .style("background", "white");


            svg
                .selectAll('circle')
                .data(dataArrayF)
                .enter()
                .append('circle')
                //.attr("id", "circleTooltip")
                .attr('cx', function (d) { return xs(d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]); })
                .attr('cy', function (d) { return ys(d["Adjusted net national income per capita (annual % growth) - NY.ADJ.NNTY.PC.KD.ZG"]); })
                .attr('r', function (d) { return rs(d["Population, total - SP.POP.TOTL"]); })
                .attr("fill", function (d) {
                    var reg = d['World Regions (UN SDG Definition)'];
                    //console.log(reg);
                    if (reg == 'Europe and Northern America')
                        return "navy";
                    else if (reg == 'Sub-Saharan Africa')
                        return "tomato";
                    /*
                            var cont = d['Continent']
                            console.log(cont);
                            if (cont == 'North America') {
                            return "lightblue";
                            } else if (cont == 'Africa') {
                            return "tomato";
                            }
                            else if (cont == 'South America') {
                            return "gold";
                            }
                            else if (cont == 'Asia') {
                            return "teal";
                            }
                            else if (cont == 'Oceania') {
                                return "violet";
                            }
                            else if (cont == 'Europe') {
                                return "navy";
                            }
                            return "yellow";*/
                })
                //.on("mouseover", mouseover)
                .on("mouseover", function (event, d) {
                    tooltip.style("visibility", "visible").text(d["Country Name"]);
                    tooltip.style("top", (d.pageY) + "px")
                        .style("left", (d.pageX) + "px");
                })
                .on("mousemove", function () { return tooltip.style("top", (event.pageY - 10) + "px").style("left", (event.pageX + 10) + "px"); })
                .on("mouseout", function () { return tooltip.style("visibility", "hidden"); });

            //legend
            svg.append("circle").attr("cx", 600).attr("cy", 0).attr("r", 6).style("fill", "tomato")
            svg.append("circle").attr("cx", 600).attr("cy", 20).attr("r", 6).style("fill", "navy")
            svg.append("text").attr("x", 620).attr("y", 0).text("Sub-Saharan Africa").style("font-size", "15px").attr("alignment-baseline", "middle")
            svg.append("text").attr("x", 620).attr("y", 20).text("Europe & Northern America").style("font-size", "15px").attr("alignment-baseline", "middle")

            var yAxis = d3.axisLeft(ys).ticks(10).tickFormat(d3.format("~s"));
            svg.append("g").call(yAxis);

            var xAxis = d3.axisBottom(xs).tickValues([0, 0.5, 1.0, 1.5, 2, 2.5, 3, 3.5, 4])//.tickFormat(d3.format("~s"));
            svg.append("g").attr("transform", "translate(0," + height + ")").call(xAxis);

            svg.append("text")
                .attr("transform", "translate(220,440)")
                //.attr("x", 250)
                //.attr("y", 200)
                .style("text-anchor", "middle")
                .text("Adjusted savings: carbon dioxide damage (% of GNI)");



            svg.append("text")
                .attr("transform", "rotate(-90)")
                .attr("y", 0 - margin.left + 10)
                .attr("x", 0 - (height / 2))
                .attr("dy", "1em")
                .style("text-anchor", "middle")
                .text("Adjusted net national income per capita (annual % growth)");


            //Axis Labels


            //add click event to the boxes
            d3.selectAll(".box").on("click", function () {
                var boxId = d3.select(this).attr("id");
                switch (boxId) {
                    case "box1":
                        goTo("index.html");
                        break;
                    case "box2":
                        goTo("chart2.html");
                        break;
                    case "box3":
                        goTo("chart3.html");
                        break;
                    default:
                        break;
                }
            });

            // create a tooltip
            var tooltip = d3.select("#chart")
                .append("div")
                //.style("top", (d3.event.pageY-200)+"px")
                //.style("left", (d3.event.pageX-100)+"px")
                .style("position", "absolute")
                .style("visibility", "hidden")
                .style("background", "white");
            // .text("I'm a circle!");


        }

        function filtered(dataArr) {
            return ((dataArr['Year'] == '2018')//&& (dataArr['Continent'] == 'North America')
                && ((dataArr['World Regions (UN SDG Definition)'] == 'Europe and Northern America')
                    || (dataArr['World Regions (UN SDG Definition)'] == 'Sub-Saharan Africa')));
        }
        loadData().catch(function (error) {
            console.log(error);
        });


        function goTo(page) {
            window.location.href = page;
        }
    </script>
</body>

</html>