<html>
    <script src="https://d3js.org/d3.v7.min.js"></script>
    
    <body>
      <h1> World Sustainability Dataset </h1>

        <div id="chart"></div>

        <script>

          async function loadData() {
          // Set up the chart dimensions
          var margin = { top: 20, right: 20, bottom: 30, left: 40 };
          var width = 800 - margin.left - margin.right;
          var height = 800 - margin.top - margin.bottom;
      
          // Create the SVG element
          var svg = d3
            .select("#chart")
            .append("svg")
            .attr("width", width + margin.left + margin.right)
            .attr("height", height + margin.top + margin.bottom)
            .append("g")
            .attr("transform", "translate(" + margin.left + "," + margin.top + ")");
      
          // Load the CSV file
          const data = await d3.csv('WorldSustainabilityDataset.csv', d3.autoType);
         // d3.csv("WorldSustainabilityDataset.csv").then(function(data) {
            // Convert numerical values from strings to numbers
          const dataArray = Object.values(data);
            //const dataArray = Array.from(data, ([key,value]) => value);
          data.sort((a,b) => d3.descending(a["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"], b["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]));
          console.log(dataArray);
          console.log(data);
          data.forEach(function(d) {
            d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"] = +d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"];
            });
      
            // Set up the scales
            var xScale = d3
              .scaleBand()
              .range([0, width])
              .padding(0.1)
              .domain(dataArray.map(function(d) {
                return d["Country Name"];
              }));
      
            var yScale = d3
              .scaleLinear()
              .range([height, 0])
              .domain([0, d3.max(dataArray, function(d) {
                return d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"];
              })]);
      
            // Create the bars
            svg
              .selectAll(".bar")
              .data(data)
              .enter()
              .append("rect")
              .attr("class", "bar")
              .attr("x", function(d) {
                return xScale(d["Country Name"]);
              })
              .attr("width", xScale.bandwidth())
              .attr("y", function(d) {
                return yScale(d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]);
              })
              .attr("height", function(d) {
                return height - yScale(d["Adjusted savings: carbon dioxide damage (% of GNI) - NY.ADJ.DCO2.GN.ZS"]);
              });
      
            // Add axes
            svg
              .append("g")
              .attr("transform", "translate(0," + height + ")")
              .call(d3.axisBottom(xScale))
              .selectAll("text")
              .style("text-anchor", "end")
              .attr("transform", "rotate(-45)");
      
            svg.append("g").call(d3.axisLeft(yScale));
          }
          loadData().catch(function(error) {console.log(error);});
          
          </script>
      </body>

</html>